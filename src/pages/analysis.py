"""
–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã MOF.
"""

import streamlit as st
import pandas as pd
import plotly.express as px
import numpy as np
from src.utils.ui.page_config import load_theme_css

def show():
    """–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã."""
    load_theme_css()
    
    st.title("–ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã MOF")
    
    st.markdown("""
    ## –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã MOF

    ### üìä –°—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ-—ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑

    MOF-–º–∞—Ç–µ—Ä–∏–∞–ª—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É—é—Ç—Å—è –∫–æ–º–ø–ª–µ–∫—Å–æ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ-—ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ (–°–≠–•), –∫–æ—Ç–æ—Ä—ã–µ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –∏—Ö –∞–¥—Å–æ—Ä–±—Ü–∏–æ–Ω–Ω—ã–µ –∏ –¥—Ä—É–≥–∏–µ —Ñ–∏–∑–∏–∫–æ-—Ö–∏–º–∏—á–µ—Å–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞. –ù–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∫–∞–∫ –¥–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö, —Ç–∞–∫ –∏ –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤.

    ### –ö–ª—é—á–µ–≤—ã–µ –°–≠–• –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

    1. **–ú–∏–∫—Ä–æ–ø–æ—Ä–∏—Å—Ç—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**
    - W‚ÇÄ (—Å–º¬≥/–≥) - —É–¥–µ–ª—å–Ω—ã–π –æ–±—ä–µ–º –º–∏–∫—Ä–æ–ø–æ—Ä
    - E‚ÇÄ (–∫–î–∂/–º–æ–ª—å) - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è –∞–¥—Å–æ—Ä–±—Ü–∏–∏ –±–µ–Ω–∑–æ–ª–∞
    - x‚ÇÄ (–Ω–º) - —Å—Ä–µ–¥–Ω—è—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –ø–æ–ª—É—à–∏—Ä–∏–Ω–∞ –º–∏–∫—Ä–æ–ø–æ—Ä
    - a‚ÇÄ (–º–º–æ–ª—å/–≥) - –ø—Ä–µ–¥–µ–ª—å–Ω–∞—è –≤–µ–ª–∏—á–∏–Ω–∞ –∞–¥—Å–æ—Ä–±—Ü–∏–∏

    2. **–ú–µ–∑–æ–ø–æ—Ä–∏—Å—Ç—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**
    - Wme (—Å–º¬≥/–≥) - –æ–±—ä–µ–º –º–µ–∑–æ–ø–æ—Ä
    - Sme (–º¬≤/–≥) - –ø–ª–æ—â–∞–¥—å –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –º–µ–∑–æ–ø–æ—Ä

    3. **–û–±—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**
    - S–ë–≠–¢ (–º¬≤/–≥) - —É–¥–µ–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –ø–æ –ë–≠–¢
    - E (–∫–î–∂/–º–æ–ª—å) - —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è –∞–¥—Å–æ—Ä–±—Ü–∏–∏ –∞–∑–æ—Ç–∞
    - Ws (—Å–º¬≥/–≥) - —Å—É–º–º–∞—Ä–Ω—ã–π –æ–±—ä–µ–º –ø–æ—Ä

    ### –ü—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

    –ù–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑–æ–≤—ã—Ö –°–≠–• –º–æ–∂–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
    - Adsorption_Potential - –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –∞–¥—Å–æ—Ä–±—Ü–∏–∏
    - Capacity_Density - –ø–ª–æ—Ç–Ω–æ—Å—Ç—å –µ–º–∫–æ—Å—Ç–∏ –∞–¥—Å–æ—Ä–±—Ü–∏–∏
    - K_equilibrium - –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ —Ä–∞–≤–Ω–æ–≤–µ—Å–∏—è
    - Delta_G - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–≤–æ–±–æ–¥–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏
    - SurfaceArea_MicroVol_Ratio - –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ø–ª–æ—â–∞–¥–∏ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –∫ –æ–±—ä–µ–º—É –º–∏–∫—Ä–æ–ø–æ—Ä
    - Adsorption_Energy_Ratio - –æ—Ç–Ω–æ—à–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–π –∞–¥—Å–æ—Ä–±—Ü–∏–∏
    - S_BET_E - –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø–ª–æ—â–∞–¥–∏ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –∏ —ç–Ω–µ—Ä–≥–∏–∏ –∞–¥—Å–æ—Ä–±—Ü–∏–∏
    - x0_W0 - –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø–æ–ª—É—à–∏—Ä–∏–Ω—ã –º–∏–∫—Ä–æ–ø–æ—Ä –∏ –æ–±—ä–µ–º–∞ –º–∏–∫—Ä–æ–ø–æ—Ä
    - B_micropore - –ø–∞—Ä–∞–º–µ—Ç—Ä, —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å –º–∏–∫—Ä–æ–ø–æ—Ä–∏—Å—Ç–æ—Å—Ç—å—é –º–∞—Ç–µ—Ä–∏–∞–ª–∞

    ### –ê–Ω–∞–ª–∏–∑ –≤–∑–∞–∏–º–æ—Å–≤—è–∑–µ–π

    –ù–∞—à–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –≤—ã—è–≤–ª—è—Ç—å –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏ –æ—Ü–µ–Ω–∏–≤–∞—Ç—å –∏—Ö –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –∞–¥—Å–æ—Ä–±—Ü–∏–æ–Ω–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤. –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –ª—É—á—à–µ –ø–æ–Ω—è—Ç—å –ø—Ä–∏—Ä–æ–¥—É –∏—Å—Å–ª–µ–¥—É–µ–º—ã—Ö MOF, –Ω–æ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Å–∏–Ω—Ç–µ–∑–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ —Å –∑–∞–¥–∞–Ω–Ω—ã–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏.
    """)
    
    uploaded_file = st.file_uploader("–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª", type=['csv', 'xlsx'])
    
    if uploaded_file is not None:
        try:
            # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —Ñ–∞–π–ª–∞ –∏ —á–∏—Ç–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            if uploaded_file.name.endswith('.csv'):
                df = pd.read_csv(uploaded_file)
            else:
                df = pd.read_excel(uploaded_file)
            
            st.success("–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!")
            
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            st.subheader("–û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏")
            st.write(df.describe())
            
            # –í—ã–±–æ—Ä –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
            numeric_cols = df.select_dtypes(include=[np.number]).columns
            if len(numeric_cols) > 0:
                x_col = st.selectbox("–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –æ—Å–∏ X:", numeric_cols)
                y_col = st.selectbox("–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –æ—Å–∏ Y:", numeric_cols)
                
                # –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
                fig = px.scatter(df, x=x_col, y=y_col, 
                               title=f"–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å {y_col} –æ—Ç {x_col}",
                               labels={x_col: x_col, y_col: y_col})
                st.plotly_chart(fig)
                
                # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—É—é –º–∞—Ç—Ä–∏—Ü—É
                st.subheader("–ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞")
                corr_matrix = df[numeric_cols].corr()
                fig_corr = px.imshow(corr_matrix,
                                   labels=dict(color="–ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è"),
                                   x=corr_matrix.columns,
                                   y=corr_matrix.columns)
                st.plotly_chart(fig_corr)
            
            else:
                st.warning("–í –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–º —Ñ–∞–π–ª–µ –Ω–µ—Ç —á–∏—Å–ª–æ–≤—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞")
                
        except Exception as e:
            st.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–∞: {str(e)}")
    
    st.markdown("""
    ### üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∞–Ω–∞–ª–∏–∑—É
    
    1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö**:
       - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã –æ—Ç –≤—ã–±—Ä–æ—Å–æ–≤
       - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö
       
    2. **–ê–Ω–∞–ª–∏–∑ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π**:
       - –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Å–∏–ª—å–Ω—ã–µ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ (>0.7)
       - –ò—Å—Å–ª–µ–¥—É–π—Ç–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏
       
    3. **–í–∏–∑—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑**:
       - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥—Ä–∞—Ñ–∏–∫–∏ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–æ–≤
       - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö
    """)

    # –î–æ–±–∞–≤–ª—è–µ–º –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
    with st.sidebar:
        st.markdown("### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–Ω–∞–ª–∏–∑–∞")
        st.slider("–¢–æ—á–Ω–æ—Å—Ç—å —Ä–∞—Å—á–µ—Ç–æ–≤", 1, 10, 5)
        st.checkbox("–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑")
        st.checkbox("–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã")

if __name__ == "__main__":
    show() 